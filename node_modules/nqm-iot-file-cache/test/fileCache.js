/**
 * Created by toby on 28/05/15.
 */

var cache = require("../fileCache");

exports.sync = function(test) {
  var testData = { msg: "testing123" };

  test.expect(1);

  var config = {
    "rootPath": "test",
    "transmitCheckFrequency": 1000,
    "maximumTransmitKB": 250,
    "transportTimeout": 60000,
    "archive": false,
    "pendingPacketThreshold": 1
  };
  var fc = new cache.FileCache(config);

  var sync = {
    sendData: function(data, cb) {
      test.ok(data === JSON.stringify(testData) + "\n","sync payload is correct");
      test.done();
      cb(null, { ok: true });
      fc.stop();
    }
  };

  fc.setSyncHandler(sync);
  fc.cacheThis(testData);
};